# User Flow (사용자 흐름도)

## 문서 메타데이터
| 항목 | 내용 |
|------|------|
| 세션 ID | draftify-userflow-v1.0 |
| 작성일 | 2026-01-04 |
| 버전 | v1.0 |

---

## 핵심 시나리오: 목업 → 기획서 PPT 생성 (FEAT-1 + FEAT-2 + FEAT-3)

```mermaid
graph TD
    A[기획자 시작] --> B[웹사이트 접속<br>localhost:3000]
    B --> C{입력 정보 제공}
    C --> C1[URL 입력]
    C --> C2[PRD/SDD 업로드]
    C --> C3[프로젝트명 입력]
    C1 & C2 & C3 --> D[크롤링 시작 버튼 클릭]

    D --> E{Phase 1: 크롤링}
    E -->|성공| F[페이지 수집 완료]
    E -->|일부 실패| F1[수동 URL 입력 요청]
    F1 --> F

    F --> G[스크린샷 자동 캡처]
    G --> H{캡처 품질 확인}
    H -->|화면 잘림| H1[재캡처]
    H1 --> H
    H -->|정상| I[Phase 2: 분석]

    I --> J[analyzed-structure.json 생성]
    J --> K{Phase 3: 생성}

    K --> K1[병렬: Policy + Glossary]
    K1 --> K2[순차: Screen Definition]
    K2 --> K3[순차: Process Flow]

    K3 --> L{Phase 3.5: 품질 검증}
    L -->|PASS| M[Phase 4: PPT 변환]
    L -->|FAIL| M1[경고 포함 PPT 생성]
    M1 --> M

    M --> N[python-pptx 실행]
    N --> O[final-draft.pptx 생성]
    O --> P[PPT 다운로드 완료]

    P --> Q{사용자 만족도 확인}
    Q -->|만족| R[성공: 2~3일 → 30분 달성]
    Q -->|불만족| S[피드백 수집]
    S --> T[v2 개선 사항 반영]
```

---

## 상세 사용자 흐름

### Scenario 1: 정상 흐름 (Happy Path)

| 단계 | 화면 | 사용자 행동 | 시스템 반응 |
|------|------|-------------|-------------|
| 1 | 홈 | 프로젝트명 입력 | 입력 필드 표시 |
| 2 | 홈 | 목업 URL 입력 | URL 유효성 검사 |
| 3 | 홈 | PRD/SDD 파일 선택 | 파일 업로드 |
| 4 | 홈 | "크롤링 시작" 클릭 | 진행률 표시 시작 |
| 5 | 크롤링 중 | 대기 | "페이지 수집 중... (5/50)" |
| 6 | 분석 중 | 대기 | "AI 분석 중..." |
| 7 | 생성 중 | 대기 | "기획서 생성 중..." |
| 8 | 완료 | "PPT 다운로드" 클릭 | final-draft.pptx 다운로드 |

### Scenario 2: SPA 크롤링 실패 → 수동 입력

| 단계 | 화면 | 사용자 행동 | 시스템 반응 |
|------|------|-------------|-------------|
| 1-4 | (동일) | (동일) | (동일) |
| 5 | 크롤링 중 | 대기 | "Tier 1 크롤링 완료: 10페이지" |
| 6 | 수동 입력 | "일부 페이지를 찾지 못했습니다" 알림 | 수동 URL 입력 폼 표시 |
| 7 | 수동 입력 | 누락된 URL 직접 입력 | 추가 크롤링 실행 |
| 8 | (정상 흐름으로 복귀) | | |

---

## 사용자 행동별 상세 흐름

### 단계 1: 프로젝트 시작

```mermaid
graph LR
    A[접속] --> B{프로젝트 있음?}
    B -->|있음| C[기존 프로젝트 선택]
    B -->|없음| D[새 프로젝트명 입력]
    D --> E[다음]
    C --> E
```

### 단계 2: 입력 정보 제공

```mermaid
graph TD
    A[입력 폼] --> B[프로젝트명]
    A --> C[목업 URL]
    A --> D[PRD/SDD 파일]
    B & C & D --> E{유효성 검사}
    E -->|실패| F[에러 메시지]
    E -->|성공| G[크롤링 시작 가능]
```

### 단계 3: 크롤링 (Phase 1)

```mermaid
graph TD
    A[크롤링 시작] --> B[Tier 1: DOM 크롤링]
    B --> C{페이지 충분?}
    C -->|예| H[완료]
    C -->|아니오| D[Tier 2: onClick 분석]
    D --> E{페이지 충분?}
    E -->|예| H
    E -->|아니오| F[Tier 3: 수동 입력]
    F --> G[사용자 입력 대기]
    G --> H
```

### 단계 4: 생성 및 다운로드 (Phase 2-4)

```mermaid
graph TD
    A[Phase 2: 분석] --> B[analyzed-structure.json]
    B --> C[Phase 3-1: 병렬 생성]
    C --> D[Policy]
    C --> E[Glossary]
    D & E --> F[Phase 3-2: 순차 생성]
    F --> G[Screen Definition]
    G --> H[Process Flow]
    H --> I{품질 검증}
    I -->|PASS| J[Phase 4: PPT 변환]
    I -->|FAIL| K[경고 포함 변환]
    K --> J
    J --> L[final-draft.pptx 다운로드]
```

---

## 오류 흐름 (Error Flows)

### E1: URL 유효성 실패

```mermaid
graph LR
    A[URL 입력] --> B{유효한 URL?}
    B -->|아니오| C[에러: 유효하지 않은 URL]
    C --> D[재입력 요청]
```

### E2: 크롤링 완전 실패

```mermaid
graph TD
    A[크롤링 시작] --> B{모든 Tier 실패}
    B -->|예| C[에러: 크롤링 불가]
    C --> D[안내: 수동 URL 입력 또는 목업 확인]
    D --> E{사용자 선택}
    E -->|수동 입력| F[수동 URL 입력 모드]
    E -->|취소| G[프로젝트 종료]
```

### E3: PPT 생성 실패

```mermaid
graph LR
    A[PPT 변환] --> B{Python 실행 가능?}
    B -->|아니오| C[에러: Python 미설치]
    C --> D[안내: Python 설치 또는 마크다운 다운로드]
    D --> E[선택]
```

---

## 성공/실패 분기 정리

| 결과 | 조건 | 다음 단계 |
|------|------|-----------|
| **완전 성공** | 모든 Phase 성공 | PPT 다운로드 → 만족도 조사 |
| **부분 성공** | 일부 Phase 실패 | 경고 포함 PPT → 피드백 |
| **크롤링 실패** | 모든 Tier 실패 | 수동 입력 또는 종료 |
| **시스템 실패** | 치명적 오류 | 에러 로그 → 종료 |

---

**문서 끝**
