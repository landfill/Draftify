# Draftify 엣지 케이스 및 대응 방안

**버전**: 1.0
**최종 갱신**: 2025-12-27
**원본 출처**: service-design.md Appendix E

---

## 엣지 케이스 카테고리

### 1. 입력 관련 (3개)
- URL 접속 실패 (404, 500, timeout)
- 파일 읽기 권한 에러
- 입력 파일 형식 불일치

### 2. 크롤링 관련 (4개)
- 페이지 수 < 3개 (불충분한 발견)
- Hash 라우팅 SPA 감지
- 인증 필요 페이지
- 50페이지 초과

### 3. 에이전트 관련 (3개)
- input-analyzer 실패 (Phase 2 중단)
- 여러 생성 에이전트 실패 (부분 성공)
- validation FAIL (계속 진행)

### 4. ID 참조 관련 (2개)
- 화면정의서에서 정책 ID 참조 시 정책 없음
- 프로세스에서 화면 ID 참조 시 화면 없음

### 5. Record 모드 관련 (2개)
- 사용자 중도 종료 (복구 필요)
- 예상 화면 수와 실제 불일치

---

## 우선순위별 대응

### P0 (Critical - 즉시 대응 필수)
1. **URL 접속 실패**: 3회 재시도 → `--screenshots` 제공 확인 → 둘 다 없으면 중단
2. **input-analyzer 실패**: 3회 재시도 → 전체 워크플로우 중단

### P1 (High - MVP 필수)
3. **페이지 수 < 3개**: Record 모드 권장 메시지 → 사용자 선택
4. **Hash 라우팅 감지**: Record 모드 전환 안내 → 중단 or 계속
5. **50페이지 초과**: 우선순위 기반 선택 (메인 네비게이션 우선)

### P2 (Medium - 부분 성공 허용)
6. **여러 생성 에이전트 실패**: 성공한 섹션만 포함하여 진행
7. **validation FAIL**: 경고와 함께 Phase 4 계속
8. **정책/화면 ID 참조 누락**: ⚠️ 마크로 표시, validation-report에 기록

### P3 (Low - 사용자 수동 대응)
9. **인증 필요 페이지**: Tier 3 (--urls) 권장 안내
10. **Record 모드 중도 종료**: 복구 파일(.record-recovery.json) 제공
11. **파일 읽기 권한 에러**: 로그 경고, 해당 파일 스킵
12. **입력 파일 형식 불일치**: 로그 경고, 파싱 실패 시 무시

---

## 테스트 시나리오

**입력 관련**:
- [ ] URL 접속 실패 시 --screenshots 폴백 테스트
- [ ] 파일 권한 에러 시 스킵 동작 확인

**크롤링 관련**:
- [ ] 페이지 < 3개 시 Record 모드 권장 메시지 표시
- [ ] Hash 라우팅 SPA 자동 감지 및 안내
- [ ] 51개 페이지 발견 시 우선순위 기반 50개 선택

**에이전트 관련**:
- [ ] input-analyzer 실패 시 전체 중단 확인
- [ ] policy-generator 실패 시 빈 섹션 생성 확인
- [ ] validation FAIL이어도 PPT 생성 확인

**ID 참조 관련**:
- [ ] 존재하지 않는 정책 ID 참조 시 ⚠️ 표시
- [ ] quality-validator가 broken reference 감지

**Record 모드 관련**:
- [ ] 중도 종료 후 복구 파일로 재시작 확인
- [ ] --output 없이 실행 시 복구 불가 경고

---

**상세 시나리오**: service-design.md Appendix E (lines 5509-5876) 참조
