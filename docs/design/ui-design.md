# Draftify 웹 UI 설계

**버전**: 1.0
**최종 갱신**: 2025-12-28
**관련 문서**: prd.md, tech-stack.md, workflow.md

---

## 목차

1. [개요](#1-개요)
2. [사용자 시나리오](#2-사용자-시나리오)
3. [화면 구성](#3-화면-구성)
4. [기술 스택](#4-기술-스택)
5. [Phase별 UI 동작](#5-phase별-ui-동작)
6. [에러 처리](#6-에러-처리)
7. [구현 우선순위](#7-구현-우선순위)

---

## 1. 개요

### 1.1 목적

Draftify 웹 UI는 **기획자가 목업/MVP 사이트를 입력하고 기획서(PPT/HTML)를 자동 생성받는** 사용자 인터페이스를 제공한다.

주 사용자인 기획자는 CLI를 사용하지 않으므로, **웹 UI가 서비스의 유일한 진입점**이다.

### 1.2 설계 원칙

1. **단순성**: `업로드 → 생성 → 결과 확인` 3단계 플로우
2. **투명성**: Phase별 진행 상태 실시간 표시
3. **내부 도구**: 인증/권한 관리 없음 (인프라 레벨 접근 통제 전제)
4. **부분 성공 허용**: 일부 Phase 실패해도 결과 제공

---

## 2. 사용자 시나리오

### 2.1 기본 시나리오 (자동 크롤링 모드)

```
1. 기획자가 MVP URL 입력 (예: http://localhost:3000)
2. [선택] PRD, SDD 파일 업로드
3. 옵션 설정 (max-pages: 50, max-depth: 5)
4. "생성 시작" 버튼 클릭
5. 진행 상태 화면으로 전환 (30분 이내 완료 예상)
   - Phase 1: 크롤링 중... (12/50 페이지)
   - Phase 2: 분석 중...
   - Phase 3-1: 정책/용어 생성 중...
   - Phase 3-2: 화면/프로세스 생성 중...
   - Phase 3.5: 품질 검증 중...
   - Phase 4: PPT 생성 중...
6. 완료 시 결과 화면으로 이동
7. PPT 다운로드 또는 HTML 미리보기
```

### 2.2 Record 모드 시나리오 (State 기반 SPA)

```
1. 기획자가 URL 입력 + "--record 모드" 체크
2. "생성 시작" 버튼 클릭
3. Chrome 브라우저 팝업 열림 (MCP 연동)
4. 기획자가 수동으로 화면 탐색
   - 각 화면에서 "캡처" 버튼 클릭
   - 사용자 동작 로깅 (클릭, 입력 등)
5. "완료" 버튼 클릭 → Phase 2로 진행
6. 이후 자동 모드와 동일
```

---

## 3. 화면 구성

### 3.1 업로드 화면 (Upload Screen)

#### 레이아웃

```
┌──────────────────────────────────────────────────────┐
│  Draftify - 기획서 자동 생성                           │
├──────────────────────────────────────────────────────┤
│                                                        │
│  📌 필수 입력                                           │
│  ┌────────────────────────────────────────────┐      │
│  │ MVP URL (필수)                              │      │
│  │ http://localhost:3000                       │      │
│  └────────────────────────────────────────────┘      │
│                                                        │
│  📎 선택 입력                                           │
│  ┌────────────────────────────────────────────┐      │
│  │ PRD 파일 (.md)         [파일 선택]          │      │
│  │ SDD 파일 (.md)         [파일 선택]          │      │
│  │ 스크린샷 (.zip)        [파일 선택]          │      │
│  │ 소스코드 디렉토리       [폴더 선택]          │      │
│  │ 수동 URL 목록 (.txt)   [파일 선택]          │      │
│  └────────────────────────────────────────────┘      │
│                                                        │
│  ⚙️ 옵션                                               │
│  ┌────────────────────────────────────────────┐      │
│  │ ☐ Record 모드 (State 기반 SPA용)            │      │
│  │ 최대 페이지:  [50    ▼]                     │      │
│  │ 최대 깊이:    [5     ▼]                     │      │
│  │ 프로젝트명:   [자동 추론 또는 입력]          │      │
│  └────────────────────────────────────────────┘      │
│                                                        │
│            [    생성 시작    ]                         │
│                                                        │
└──────────────────────────────────────────────────────┘
```

#### 필드 설명

| 필드 | 타입 | 필수 | 설명 |
|------|------|------|------|
| MVP URL | text | ✅ | 크롤링 대상 URL (localhost 또는 공개 URL) |
| PRD 파일 | file | ❌ | Markdown 기반 PRD (.md) |
| SDD 파일 | file | ❌ | Markdown 기반 SDD (.md) |
| 스크린샷 | file | ❌ | 압축 파일 (.zip) 또는 개별 이미지 |
| 소스코드 디렉토리 | folder | ❌ | 로컬 Git 리포지토리 경로 |
| 수동 URL 목록 | file | ❌ | 라인별 URL 리스트 (.txt) |
| Record 모드 | checkbox | ❌ | State 기반 SPA 수동 캡처 모드 |
| 최대 페이지 | number | ❌ | 기본값: 50 |
| 최대 깊이 | number | ❌ | 기본값: 5 |
| 프로젝트명 | text | ❌ | 기본값: URL/문서에서 자동 추론 |

#### 유효성 검사

- URL 형식 검증 (`http://` 또는 `https://`)
- 파일 확장자 검증 (.md, .zip, .txt)
- 최대 페이지: 1-100
- 최대 깊이: 1-10

---

### 3.2 진행 상태 화면 (Progress Screen)

#### 레이아웃

```
┌──────────────────────────────────────────────────────┐
│  생성 중... (예상 30분 이내)                            │
├──────────────────────────────────────────────────────┤
│                                                        │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 42%          │
│                                                        │
│  ✅ Phase 1: 크롤링 완료 (50/50 페이지, 25분)          │
│  ✅ Phase 2: 분석 완료 (10분)                          │
│  🔄 Phase 3-1: 정책/용어 생성 중... (5분)              │
│  ⏸️  Phase 3-2: 대기 중                                │
│  ⏸️  Phase 3.5: 대기 중                                │
│  ⏸️  Phase 4: 대기 중                                  │
│                                                        │
│  📊 상세 로그                                          │
│  ┌────────────────────────────────────────────┐      │
│  │ [12:34:56] Phase 1 시작                     │      │
│  │ [12:35:23] 페이지 발견: /home               │      │
│  │ [12:35:45] 스크린샷 캡처: screen-001.png    │      │
│  │ [12:59:12] Phase 1 완료 (50 페이지)         │      │
│  │ [12:59:15] Phase 2 시작                     │      │
│  │ [13:09:20] analyzed-structure.json 생성     │      │
│  │ ...                                          │      │
│  └────────────────────────────────────────────┘      │
│                                                        │
│            [    중단    ]                              │
│                                                        │
└──────────────────────────────────────────────────────┘
```

#### Phase 상태 표시

| 아이콘 | 상태 | 설명 |
|--------|------|------|
| ⏸️ | 대기 중 | 아직 시작 안 함 |
| 🔄 | 진행 중 | 현재 실행 중 |
| ✅ | 완료 | 성공적으로 완료 |
| ⚠️ | 경고 | 완료했으나 경고 있음 |
| ❌ | 실패 | 실패 (부분 성공 계속) |

#### 실시간 업데이트 (HTTP Polling)

- 1초마다 백엔드 `/api/status/{sessionId}` 호출
- 응답 JSON:
```json
{
  "sessionId": "uuid",
  "status": "in_progress",
  "currentPhase": "3-1",
  "progress": 42,
  "phases": {
    "1": { "status": "completed", "pages": 50, "duration": "25m" },
    "2": { "status": "completed", "duration": "10m" },
    "3-1": { "status": "in_progress", "eta": "5m" },
    "3-2": { "status": "pending" },
    "3.5": { "status": "pending" },
    "4": { "status": "pending" }
  },
  "logs": [
    "[12:34:56] Phase 1 시작",
    "[12:35:23] 페이지 발견: /home",
    ...
  ]
}
```

---

### 3.3 결과 화면 (Result Screen)

#### 레이아웃 (성공)

```
┌──────────────────────────────────────────────────────┐
│  ✅ 기획서 생성 완료!                                   │
├──────────────────────────────────────────────────────┤
│                                                        │
│  📄 생성된 기획서                                       │
│  ┌────────────────────────────────────────────┐      │
│  │ 프로젝트: todo-app                          │      │
│  │ 생성일시: 2025-12-28 13:30:45               │      │
│  │ 소요시간: 28분 12초                          │      │
│  │                                              │      │
│  │ 📊 통계                                      │      │
│  │ - 크롤링: 50 페이지                          │      │
│  │ - 정책: 12개 (POL-AUTH-001 ~ POL-UI-003)    │      │
│  │ - 화면: 8개 (SCR-001 ~ SCR-008)             │      │
│  │ - 용어: 15개                                 │      │
│  │                                              │      │
│  │ ⚠️  검증 경고 2건                            │      │
│  │ - POL-AUTH-005 참조 누락 (screen-003.md)   │      │
│  │ - 이미지 링크 깨짐 (screen-007.md)          │      │
│  └────────────────────────────────────────────┘      │
│                                                        │
│  💾 다운로드                                           │
│  [  final-draft.pptx (2.3 MB)  ]                      │
│  [  final-draft.html            ]                      │
│  [  전체 파일 (.zip)            ]                      │
│                                                        │
│  👁️  미리보기                                          │
│  ┌────────────────────────────────────────────┐      │
│  │ [HTML 렌더링 뷰 - iframe 또는 새 탭]         │      │
│  └────────────────────────────────────────────┘      │
│                                                        │
│  📂 상세 파일                                          │
│  - analysis/crawling-result.json                      │
│  - analysis/analyzed-structure.json                   │
│  - sections/05-glossary.md                            │
│  - sections/06-policy-definition.md                   │
│  - sections/08-screen-definition.md                   │
│  - validation/validation-report.md                    │
│                                                        │
│     [  새 기획서 생성  ]    [  히스토리  ]             │
│                                                        │
└──────────────────────────────────────────────────────┘
```

#### 레이아웃 (부분 실패)

```
┌──────────────────────────────────────────────────────┐
│  ⚠️  기획서 생성 완료 (일부 실패)                        │
├──────────────────────────────────────────────────────┤
│                                                        │
│  ❌ 실패한 Phase                                       │
│  - Phase 3-2: process-generator 타임아웃             │
│  - Phase 4: PPT 생성 실패 (python-pptx 오류)         │
│                                                        │
│  ✅ 생성된 항목 (부분 성공)                             │
│  - 정책정의서 (06-policy-definition.md)               │
│  - 용어집 (05-glossary.md)                            │
│  - 화면정의서 (08-screen-definition.md)               │
│                                                        │
│  💾 다운로드                                           │
│  [  부분 결과 (.zip)  ]                                │
│  [  에러 로그          ]                                │
│                                                        │
│     [  재시도  ]    [  새 기획서 생성  ]                │
│                                                        │
└──────────────────────────────────────────────────────┘
```

---

### 3.4 Record 모드 화면

Record 모드 선택 시, Chrome DevTools MCP를 통해 **브라우저 내 캡처 UI**를 제공한다.

#### 브라우저 오버레이 UI

```
┌──────────────────────────────────────────────────────┐
│  🔴 Recording... (wordcrack.world)                    │
│  [캡처] [완료] [취소]                                  │
├──────────────────────────────────────────────────────┤
│                                                        │
│  (실제 웹사이트 화면)                                   │
│                                                        │
│  ┌────────────────────────────────────────────┐      │
│  │ Wordcrack 게임                              │      │
│  │ [시작하기]                                   │      │
│  └────────────────────────────────────────────┘      │
│                                                        │
└──────────────────────────────────────────────────────┘

우측 사이드바:
┌─────────────────────────┐
│ 📸 캡처된 화면 (3)       │
│ ✅ Home                  │
│ ✅ Quiz                  │
│ ✅ Result                │
│                          │
│ 🎬 사용자 동작 로그      │
│ - click: 시작하기 버튼   │
│ - input: 답변 입력       │
│ - click: 제출            │
└─────────────────────────┘
```

#### 작업 흐름

1. 기획자가 화면을 수동 탐색
2. 각 화면에서 "캡처" 버튼 클릭 → 스크린샷 저장
3. 클릭/입력 등 동작 자동 로깅
4. "완료" 버튼 → Phase 2로 진행

---

## 4. 기술 스택

### 4.1 프론트엔드

- **프레임워크**: Next.js 15 (App Router) 또는 React 19
- **UI 라이브러리**: ShadCN UI
- **상태 관리**: Zustand (세션 상태, 진행률)
- **HTTP 클라이언트**: Tanstack Query (Polling)
- **파일 업로드**: React Dropzone

### 4.2 백엔드 API

- **엔드포인트**:
  - `POST /api/draft/create`: 새 세션 생성 및 생성 시작
  - `GET /api/draft/status/{sessionId}`: 진행 상태 조회
  - `POST /api/draft/cancel/{sessionId}`: 생성 중단
  - `GET /api/draft/result/{sessionId}`: 결과 조회
  - `GET /api/draft/download/{sessionId}/{file}`: 파일 다운로드

- **구현**:
  - /auto-draft Skill을 백엔드에서 호출
  - 세션 관리 (Redis 또는 파일 시스템)
  - 로그 스트리밍 (WebSocket 또는 Polling)

### 4.3 상태 동기화 (HTTP Polling)

```typescript
// Tanstack Query 예시
const { data: status } = useQuery({
  queryKey: ['draftStatus', sessionId],
  queryFn: () => fetch(`/api/draft/status/${sessionId}`).then(r => r.json()),
  refetchInterval: 1000, // 1초마다 폴링
  enabled: !!sessionId && status?.status !== 'completed'
});
```

---

## 5. Phase별 UI 동작

### Phase 1: 크롤링

**UI 표시**:
- 진행률: `12/50 페이지`
- 로그: `[12:35:23] 페이지 발견: /home`

**백엔드 동작**:
- Chrome DevTools MCP로 페이지 크롤링
- `crawling-result.json` 생성

---

### Phase 2: 분석

**UI 표시**:
- 진행률: `분석 중... (예상 10분)`
- 로그: `[12:59:20] analyzed-structure.json 생성`

**백엔드 동작**:
- input-analyzer 에이전트 실행

---

### Phase 3-1: 정책/용어 생성

**UI 표시**:
- 진행률: `정책/용어 생성 중... (2/2)`
- 로그:
  - `[13:09:25] policy-generator 시작`
  - `[13:14:30] 06-policy-definition.md 생성`
  - `[13:14:35] glossary-generator 시작`

**백엔드 동작**:
- policy-generator → glossary-generator (순차)

---

### Phase 3-2: 화면/프로세스 생성

**UI 표시**:
- 진행률: `화면/프로세스 생성 중... (병렬)`
- 로그:
  - `[13:17:40] screen-generator 시작`
  - `[13:17:42] process-generator 시작`

**백엔드 동작**:
- screen-generator, process-generator (병렬)

---

### Phase 3.5: 품질 검증

**UI 표시**:
- 진행률: `품질 검증 중...`
- 로그: `[13:22:50] validation-report.md 생성`

**백엔드 동작**:
- quality-validator 실행

---

### Phase 4: PPT 생성

**UI 표시**:
- 진행률: `PPT 생성 중...`
- 로그: `[13:25:55] final-draft.pptx 생성 완료`

**백엔드 동작**:
- /ppt-generator 스킬 실행

---

## 6. 에러 처리

### 6.1 입력 검증 실패

**UI 표시**:
```
❌ 오류: URL 형식이 올바르지 않습니다.
예시: http://localhost:3000
```

### 6.2 Phase 실패 (부분 성공)

**UI 표시**:
```
⚠️  Phase 3-2 실패: process-generator 타임아웃
✅ 다른 섹션은 정상 생성되었습니다.
```

**동작**:
- 다음 Phase 계속 진행
- 결과 화면에서 부분 결과 제공

### 6.3 전체 실패 (input-analyzer 실패)

**UI 표시**:
```
❌ 생성 실패: analyzed-structure.json 생성 불가
원인: 크롤링 결과가 비어 있습니다.

제안:
- URL이 접근 가능한지 확인
- Record 모드로 다시 시도
```

**동작**:
- 즉시 중단
- 에러 로그 제공

### 6.4 타임아웃

**UI 표시**:
```
⏱️  타임아웃: 30분 초과
✅ 생성된 항목까지 결과를 제공합니다.
```

---

## 7. 구현 우선순위

### 7.1 MVP (Minimum Viable Product)

**Phase 1**: 기본 UI (자동 크롤링 모드만)
- ✅ 업로드 화면 (URL + 기본 옵션)
- ✅ 진행 상태 화면 (HTTP Polling)
- ✅ 결과 화면 (다운로드)
- ❌ Record 모드 제외
- ❌ 미리보기 제외

**Phase 2**: Record 모드 추가
- ✅ Record 모드 체크박스
- ✅ 브라우저 오버레이 UI
- ✅ 수동 캡처 기능

**Phase 3**: 고급 기능
- ✅ HTML 미리보기
- ✅ 히스토리 관리
- ✅ 파일별 개별 다운로드

### 7.2 기술 검증 항목

1. **Chrome DevTools MCP 연동**
   - 백엔드에서 /auto-draft Skill 호출 가능한지
   - 세션 ID 기반 상태 관리

2. **HTTP Polling 성능**
   - 1초 간격 폴링 부하 테스트
   - 대안: WebSocket (선택)

3. **파일 업로드 크기 제한**
   - PRD/SDD: 최대 10MB
   - Screenshots: 최대 100MB

---

## 8. 참고사항

### 8.1 PRD 요구사항 충족

| PRD 요구사항 | UI 구현 |
|--------------|---------|
| 업로드 → 생성 → 결과 플로우 | ✅ 3개 화면 구성 |
| 중간 결과 또는 진행 상태 확인 | ✅ Phase별 실시간 표시 |
| 30분 이내 결과 도출 | ✅ 타임아웃 표시 + 중단 기능 |
| 부분 실패 시에도 결과 제공 | ✅ 부분 성공 UI 처리 |
| Record 모드 (SPA 대응) | ✅ 브라우저 오버레이 UI |

### 8.2 제외 범위

- ❌ 사용자 인증/권한 (인프라 레벨 처리)
- ❌ 협업 기능 (동시 다중 사용자)
- ❌ 버전 관리 (Git 연동)
- ❌ 기획서 수정 에디터 (결과는 다운로드 후 수정)

---

## 부록: API 명세 예시

### POST /api/draft/create

**요청**:
```json
{
  "url": "http://localhost:3000",
  "prd": "base64_encoded_content",
  "sdd": "base64_encoded_content",
  "screenshots": ["base64_img1", "base64_img2"],
  "options": {
    "maxPages": 50,
    "maxDepth": 5,
    "recordMode": false,
    "projectName": "todo-app"
  }
}
```

**응답**:
```json
{
  "sessionId": "550e8400-e29b-41d4-a716-446655440000",
  "status": "started",
  "estimatedTime": "30m"
}
```

### GET /api/draft/status/{sessionId}

**응답**: (앞서 3.2 참조)

---

**문서 종료**
