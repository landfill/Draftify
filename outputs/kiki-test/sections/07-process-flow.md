# 프로세스 흐름 (Process Flow)

본 문서는 KIKI Shop 서비스의 전체 프로세스 흐름을 정의한다.

---

## 1. 전체 서비스 프로세스 개요

```
[진입] → [탐색] → [인증] → [주문준비] → [결제] → [완료] → [관리]
```

### 주요 단계별 화면 매핑

| 단계 | 설명 | 관련 화면 |
|------|------|----------|
| 진입 | 서비스 첫 접근 | SCR-001 (메인) |
| 탐색 | 상품 검색 및 조회 | SCR-003, SCR-004, SCR-010 |
| 인증 | 로그인/회원가입 | SCR-002 |
| 주문준비 | 장바구니 관리 | SCR-005 |
| 결제 | 주문 및 결제 | SCR-006 |
| 완료 | 주문 확인 | SCR-007 |
| 관리 | 회원/주문 관리 | SCR-008, SCR-009 |

---

## 2. 핵심 사용자 여정 (Primary User Journey)

### 2.1 비회원 상품 구매 흐름

```
SCR-001 (메인)
    │
    ├─→ SCR-010 (검색) ─→ SCR-003 (목록) ─→ SCR-004 (상세)
    │                                           │
    │                                           ▼
    │                                    [장바구니 담기]
    │                                           │
    ▼                                           ▼
SCR-003 (목록) ─────────────────────────→ SCR-005 (장바구니)
                                               │
                                               ▼
                                        [주문하기 클릭]
                                               │
                                               ▼
                                        SCR-002 (로그인)
                                          │      │
                            [회원 로그인]──┘      └──[비회원 주문]
                                          │           │
                                          ▼           ▼
                                    SCR-006 (결제) ←──┘
                                          │
                                          ▼
                                    SCR-007 (완료)
```

### 2.2 회원 재구매 흐름

```
SCR-001 (메인)
    │
    ▼
SCR-002 (로그인) ─→ [로그인 완료]
                        │
                        ▼
                   SCR-001 (메인)
                        │
                        ├─→ SCR-008 (마이페이지) ─→ SCR-009 (주문내역)
                        │                               │
                        │                         [재주문 클릭]
                        │                               │
                        ▼                               ▼
                   SCR-004 (상세) ─────────────→ SCR-005 (장바구니)
                                                       │
                                                       ▼
                                                 SCR-006 (결제)
                                                       │
                                                       ▼
                                                 SCR-007 (완료)
```

---

## 3. 세부 프로세스 정의

### 3.1 로그인 프로세스

```
[로그인 화면 진입]
       │
       ▼
┌─────────────────┐
│  이메일/비밀번호  │
│     입력        │
└────────┬────────┘
         │
         ▼
    <입력값 검증>
         │
    ┌────┴────┐
    │ 실패    │ 성공
    ▼         ▼
[에러 표시]  <서버 인증>
    │             │
    │        ┌────┴────┐
    │        │ 실패    │ 성공
    │        ▼         ▼
    │   [실패 횟수   [토큰 발급]
    │     증가]          │
    │        │           ▼
    └────────┤     [메인으로 이동]
             │
             ▼
        <5회 초과?>
             │
        ┌────┴────┐
        │ Yes     │ No
        ▼         ▼
   [계정 잠금]  [재시도]
```

**관련 정책**: POL-AUTH-001, POL-AUTH-002

### 3.2 장바구니 → 결제 프로세스

```
[장바구니 화면]
       │
       ▼
<상품 유효성 검증>
       │
  ┌────┴────┐
  │품절 존재 │ 전체 유효
  ▼          ▼
[품절 알림] [주문하기 활성화]
  │              │
  ▼              ▼
[품절 상품    [주문하기 클릭]
  삭제]           │
  │              ▼
  └─────→  <로그인 상태?>
                 │
            ┌────┴────┐
            │ No      │ Yes
            ▼         ▼
       [로그인으로   [결제 화면으로
         이동]        이동]
```

**관련 정책**: POL-BIZ-001, POL-ERR-002

### 3.3 결제 프로세스

```
[결제 화면 진입]
       │
       ▼
┌─────────────────┐
│   배송지 입력    │
│  (기본배송지/신규) │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  할인 수단 적용   │
│ (쿠폰/적립금)    │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   결제수단 선택   │
│  (카드/간편결제)  │
└────────┬────────┘
         │
         ▼
    [결제하기 클릭]
         │
         ▼
    <PG 결제 요청>
         │
    ┌────┴────┐
    │ 실패    │ 성공
    ▼         ▼
[에러 표시]  <재고 최종 확인>
    │              │
    │         ┌────┴────┐
    │         │품절 발생 │ 정상
    │         ▼         ▼
    │    [환불 처리]  [주문 생성]
    │         │          │
    └─────────┤          ▼
              │    [결제 완료]
              │          │
              ▼          ▼
         [재시도 안내] [완료 화면 이동]
```

**관련 정책**: POL-PAY-001, POL-PAY-002, POL-PAY-003, POL-ERR-001

---

## 4. 분기 조건 정리

| 분기점 | 조건 | True 경로 | False 경로 |
|--------|------|----------|-----------|
| 로그인 상태 확인 | 토큰 유효 | 결제 진행 | 로그인 화면 |
| 장바구니 품절 확인 | 품절 상품 존재 | 품절 알림 | 주문 진행 |
| 무료배송 조건 | 금액 ≥ 50,000 | 배송비 0원 | 배송비 3,000원 |
| 로그인 실패 횟수 | 횟수 ≥ 5 | 계정 잠금 | 재시도 허용 |
| 주문 취소 가능 | 30분 이내 | 즉시 취소 | CS 문의 안내 |

---

## 5. 예외 흐름

### 5.1 세션 만료 시
- 현재 작업 저장 (장바구니는 로컬 저장)
- 로그인 화면으로 이동
- 로그인 후 원래 화면으로 복귀

### 5.2 결제 중 네트워크 오류 시
- 자동 재시도 (최대 3회)
- 실패 시 "잠시 후 다시 시도해주세요" 메시지
- 주문 상태: 미결제 (30분 내 재결제 가능)

### 5.3 재고 부족 시 (결제 중)
- 결제 취소 및 환불 처리
- 품절 알림 표시
- 장바구니로 이동
